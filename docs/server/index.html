<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Initial | iforu Project Guide</title>
    <meta name="description" content="system administrator&#39;s memo">
    <meta name="generator" content="VuePress 1.3.1">
    
    
    <link rel="preload" href="/iforu/assets/css/0.styles.adbe3e3d.css" as="style"><link rel="preload" href="/iforu/assets/js/app.24cfdda6.js" as="script"><link rel="preload" href="/iforu/assets/js/2.c8a78117.js" as="script"><link rel="preload" href="/iforu/assets/js/29.8276d66d.js" as="script"><link rel="prefetch" href="/iforu/assets/js/10.6b8d26b1.js"><link rel="prefetch" href="/iforu/assets/js/11.a5e423ee.js"><link rel="prefetch" href="/iforu/assets/js/12.56fada03.js"><link rel="prefetch" href="/iforu/assets/js/13.a9bf633e.js"><link rel="prefetch" href="/iforu/assets/js/14.1ad1bb49.js"><link rel="prefetch" href="/iforu/assets/js/15.782c77a6.js"><link rel="prefetch" href="/iforu/assets/js/16.f8b34585.js"><link rel="prefetch" href="/iforu/assets/js/17.e77f5fa4.js"><link rel="prefetch" href="/iforu/assets/js/18.2ba23f43.js"><link rel="prefetch" href="/iforu/assets/js/19.189d65e6.js"><link rel="prefetch" href="/iforu/assets/js/20.306c2105.js"><link rel="prefetch" href="/iforu/assets/js/21.6510756c.js"><link rel="prefetch" href="/iforu/assets/js/22.c31b2590.js"><link rel="prefetch" href="/iforu/assets/js/23.5ffa5d32.js"><link rel="prefetch" href="/iforu/assets/js/24.6db13623.js"><link rel="prefetch" href="/iforu/assets/js/25.a83aa4ef.js"><link rel="prefetch" href="/iforu/assets/js/26.cbee5b93.js"><link rel="prefetch" href="/iforu/assets/js/27.8d16dc9b.js"><link rel="prefetch" href="/iforu/assets/js/28.21f3e228.js"><link rel="prefetch" href="/iforu/assets/js/3.45aaba56.js"><link rel="prefetch" href="/iforu/assets/js/30.4f90e09d.js"><link rel="prefetch" href="/iforu/assets/js/31.ea20c7a6.js"><link rel="prefetch" href="/iforu/assets/js/32.1112c568.js"><link rel="prefetch" href="/iforu/assets/js/33.b6e27c2f.js"><link rel="prefetch" href="/iforu/assets/js/34.fa0692e7.js"><link rel="prefetch" href="/iforu/assets/js/35.a340c0a4.js"><link rel="prefetch" href="/iforu/assets/js/36.32edf14c.js"><link rel="prefetch" href="/iforu/assets/js/37.dba0dbfa.js"><link rel="prefetch" href="/iforu/assets/js/38.780a20cb.js"><link rel="prefetch" href="/iforu/assets/js/39.adc8e0e4.js"><link rel="prefetch" href="/iforu/assets/js/4.df91fca7.js"><link rel="prefetch" href="/iforu/assets/js/40.7d880953.js"><link rel="prefetch" href="/iforu/assets/js/41.6f8ab3c9.js"><link rel="prefetch" href="/iforu/assets/js/5.0f115d5f.js"><link rel="prefetch" href="/iforu/assets/js/6.f5b070e2.js"><link rel="prefetch" href="/iforu/assets/js/7.fe9ac40b.js"><link rel="prefetch" href="/iforu/assets/js/8.18a3960b.js"><link rel="prefetch" href="/iforu/assets/js/9.ebed5abe.js">
    <link rel="stylesheet" href="/iforu/assets/css/0.styles.adbe3e3d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/iforu/" class="home-link router-link-active"><!----> <span class="site-name">iforu Project Guide</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/iforu/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/iforu/server/" class="nav-link router-link-exact-active router-link-active">
  Server
</a></div><div class="nav-item"><a href="/iforu/hicloud/" class="nav-link">
  Hicloud
</a></div><div class="nav-item"><a href="/iforu/third-party/" class="nav-link">
  Third Party
</a></div><div class="nav-item"><a href="/iforu/security/burpsuite/" class="nav-link">
  Security
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/iforu/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/iforu/server/" class="nav-link router-link-exact-active router-link-active">
  Server
</a></div><div class="nav-item"><a href="/iforu/hicloud/" class="nav-link">
  Hicloud
</a></div><div class="nav-item"><a href="/iforu/third-party/" class="nav-link">
  Third Party
</a></div><div class="nav-item"><a href="/iforu/security/burpsuite/" class="nav-link">
  Security
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/iforu/server/" class="active sidebar-link">Initial</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/iforu/server/#hostname" class="sidebar-link">hostname</a></li><li class="sidebar-sub-header"><a href="/iforu/server/#set-sysctl" class="sidebar-link">set sysctl</a></li><li class="sidebar-sub-header"><a href="/iforu/server/#common-packages" class="sidebar-link">common packages</a></li><li class="sidebar-sub-header"><a href="/iforu/server/#chrony" class="sidebar-link">chrony</a></li><li class="sidebar-sub-header"><a href="/iforu/server/#s3cmd" class="sidebar-link">S3cmd</a></li><li class="sidebar-sub-header"><a href="/iforu/server/#iserver-linux-agent" class="sidebar-link">iServer Linux Agent</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/iforu/server/#policy" class="sidebar-link">policy</a></li></ul></li></ul></li><li><a href="/iforu/server/firewalld.html" class="sidebar-link">firewalld</a></li><li><a href="/iforu/server/httpd2tomcat.html" class="sidebar-link">HTTPD/TOMCAT</a></li><li><a href="/iforu/server/awshttpd2tomcat.html" class="sidebar-link">AWS/HTTPD/TOMCAT</a></li><li><a href="/iforu/server/ssl.html" class="sidebar-link">SSL</a></li><li><a href="/iforu/server/SSL SNI.html" class="sidebar-link">SSL SNI</a></li><li><a href="/iforu/server/pgsql.html" class="sidebar-link">PostgreSQL</a></li><li><a href="/iforu/server/redis.html" class="sidebar-link">Redis</a></li><li><a href="/iforu/server/solr.html" class="sidebar-link">Solr</a></li><li><a href="/iforu/server/syslog.html" class="sidebar-link">syslog</a></li><li><a href="/iforu/server/sftp.html" class="sidebar-link">SFTP without SSH</a></li><li><a href="/iforu/server/Route Table.html" class="sidebar-link">Route Table</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="initial"><a href="#initial" class="header-anchor">#</a> Initial</h1> <p>伺服端相關設定</p> <h2 id="hostname"><a href="#hostname" class="header-anchor">#</a> hostname</h2> <p><code>/etc/hostname</code></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">echo</span> <span class="token string">&quot;your_hostname&quot;</span> <span class="token operator">&gt;</span> /etc/hostname
</code></pre></div><h2 id="set-sysctl"><a href="#set-sysctl" class="header-anchor">#</a> set sysctl</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>/bin/sh -c <span class="token string">'cat &gt; set_sysctl.sh &lt;&lt; &quot;EOF&quot;
#! /bin/bash

set -o noclobber

SYSCTLCMD=/sbin/sysctl
SYSCTLCONF=/etc/sysctl.conf

function set_sysctl() {
    src_value=<span class="token variable"><span class="token variable">`</span>$SYSCTLCMD -n $1<span class="token variable">`</span></span>
    if <span class="token variable"><span class="token punctuation">((</span> $src_value <span class="token operator">&lt;</span> $<span class="token number">2</span> <span class="token punctuation">))</span></span>; then
        if grep -q ^<span class="token variable">$1</span> <span class="token variable">$SYSCTLCONF</span>; then
            sed -i &quot;/^<span class="token variable">$1</span>/s/[[:digit:]]\+$/<span class="token variable">$2</span>/&quot; <span class="token variable">$SYSCTLCONF</span>
        else
            echo &quot;<span class="token variable">$1</span> = <span class="token variable">$2</span>&quot; &gt;&gt; <span class="token variable">$SYSCTLCONF</span>
        fi
    fi
}

set_sysctl fs.file-max 1000000
set_sysctl net.core.somaxconn 3240000
set_sysctl net.ipv4.tcp_max_syn_backlog 3240000

<span class="token variable">$SYSCTLCMD</span> -p /etc/sysctl.conf
EOF'</span> <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> /bin/sh set_sysctl.sh <span class="token punctuation">\</span>
<span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>rm set_sysctl.sh
</code></pre></div><h2 id="common-packages"><a href="#common-packages" class="header-anchor">#</a> common packages</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>yum -y <span class="token function">install</span> epel-release
</code></pre></div><h2 id="chrony"><a href="#chrony" class="header-anchor">#</a> chrony</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>yum -y <span class="token function">install</span> chrony
</code></pre></div><p><code>/etc/chrony.conf</code></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sed</span> -i <span class="token string">'/^pool/a\server 0.tw.pool.ntp.org iburst<span class="token entity" title="\n">\n</span>server 1.tw.pool.ntp.org iburst<span class="token entity" title="\n">\n</span>server 2.tw.pool.ntp.org iburst<span class="token entity" title="\n">\n</span>server 3.tw.pool.ntp.org iburst'</span> /etc/chrony.conf
<span class="token function">sed</span> -i <span class="token string">'/^pool/s/^/#/'</span> /etc/chrony.conf
systemctl start chronyd
systemctl <span class="token builtin class-name">enable</span> chronyd

chronyc -a makestep
</code></pre></div><h2 id="s3cmd"><a href="#s3cmd" class="header-anchor">#</a> S3cmd</h2> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># yum -y install epel-release</span>
yum -y <span class="token function">install</span> s3cmd
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code>s3cmd --configure
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>  Access Key: your ak
  Secret Key: your sk
  Default Region: US
  S3 Endpoint: s3.hicloud.net.tw
  DNS-style bucket+hostname:port template for accessing a bucket: %(bucket)s.s3.hicloud.net.tw
  Encryption password:
  Path to GPG program: /usr/bin/gpg
  Use HTTPS protocol: True
  HTTP Proxy server name:
  HTTP Proxy server port: 0
  
Test access with supplied credentials? [Y/n] n

Save settings? [y/N] Y
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sed</span> -i <span class="token string">'/^signature_v2/s/False/True/'</span> /root/.s3cfg
<span class="token function">sed</span> -i <span class="token string">'/^signurl_use_https/s/False/True/'</span> /root/.s3cfg
<span class="token function">sed</span> -i <span class="token string">'/^use_https/s/False/True/'</span> /root/.s3cfg
<span class="token function">sed</span> -i <span class="token string">'/^progress_meter/s/True/False/'</span> /root/.s3cfg
s3cmd <span class="token function">ls</span>
</code></pre></div><h2 id="iserver-linux-agent"><a href="#iserver-linux-agent" class="header-anchor">#</a> iServer Linux Agent</h2> <ul><li>Agent Version : iServer_setup_linux_3.6.7_x86_64.tar</li> <li>Server IP : 202.39.165.13</li> <li>跳板機 Server IP：10.190.251.33</li> <li>InventoryID : <a href="/iforu/hicloud/#server-list">#serverlist</a></li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>s3cmd get s3://mgmt/iServer_setup_linux_3.6.7_x86_64.tar ./
<span class="token function">tar</span> -xf iServer_setup_linux_3.6.7_x86_64.tar
<span class="token builtin class-name">cd</span> setup
./install.sh
</code></pre></div><p>check process</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> isAgent
</code></pre></div><h3 id="policy"><a href="#policy" class="header-anchor">#</a> policy</h3> <h4 id="帳戶密碼最大使用期限超過90天"><a href="#帳戶密碼最大使用期限超過90天" class="header-anchor">#</a> 帳戶密碼最大使用期限超過90天</h4> <div class="language-sh extra-class"><pre class="language-sh"><code>chage -M <span class="token number">90</span> root
<span class="token function">sed</span> -i <span class="token string">'/^PASS_MAX_DAYS/s/[[:digit:]]\+$/90/'</span> /etc/login.defs
<span class="token function">grep</span> ^PASS_MAX_DAYS /etc/login.defs
</code></pre></div><h4 id="閒置連線關閉時間超過30分鐘"><a href="#閒置連線關閉時間超過30分鐘" class="header-anchor">#</a> 閒置連線關閉時間超過30分鐘</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sed</span> -i <span class="token string">'s/^#ClientAliveInterval.*/ClientAliveInterval 600/'</span> /etc/ssh/sshd_config
<span class="token function">sed</span> -i <span class="token string">'/ClientAliveCountMax/s/^#//'</span> /etc/ssh/sshd_config
systemctl restart sshd
</code></pre></div><h4 id="帳戶登入失敗次數超過3次"><a href="#帳戶登入失敗次數超過3次" class="header-anchor">#</a> 帳戶登入失敗次數超過3次</h4> <h4 id="帳戶密碼最小長度小於12字元"><a href="#帳戶密碼最小長度小於12字元" class="header-anchor">#</a> 帳戶密碼最小長度小於12字元</h4> <h4 id="密碼設定歷程小於3代"><a href="#密碼設定歷程小於3代" class="header-anchor">#</a> 密碼設定歷程小於3代</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">cp</span> /etc/pam.d/system-auth /etc/pam.d/system-auth.def
<span class="token function">sed</span> -i <span class="token string">'/^auth.*pam_env.so$/a<span class="token entity" title="\a">\a</span>uth<span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span>required<span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span>pam_faillock.so preauth silent audit deny=3 unlock_time=1800'</span> /etc/pam.d/system-auth
<span class="token function">sed</span> -i <span class="token string">'/^account.*pam_unix.so$/i<span class="token entity" title="\a">\a</span>ccount<span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span>required<span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span>pam_faillock.so'</span> /etc/pam.d/system-auth
<span class="token function">sed</span> -i <span class="token string">'/^password.*requisite/s/pam_pwquality.*/pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type= minlen=12 dcredit=-1 ucredit=-1 lcredit=-1 ocredit=-1 enforce_for_root/'</span> /etc/pam.d/system-auth
<span class="token function">sed</span> -i <span class="token string">'0,/^password/s/\(^password.*\)/<span class="token entity" title="\1">\1</span><span class="token entity" title="\n">\n</span>password<span class="token entity" title="\t">\t</span>requisite<span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span>pam_pwhistory.so use_authtok remember=3/'</span> /etc/pam.d/system-auth
</code></pre></div><div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">cp</span> /etc/pam.d/password-auth /etc/pam.d/password-auth.def
<span class="token function">sed</span> -i <span class="token string">'/^auth.*pam_env.so$/a<span class="token entity" title="\a">\a</span>uth<span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span>required<span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span>pam_faillock.so preauth silent audit deny=3 unlock_time=1800'</span> /etc/pam.d/password-auth
<span class="token function">sed</span> -i <span class="token string">'/^account.*pam_unix.so$/i<span class="token entity" title="\a">\a</span>ccount<span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span>required<span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span><span class="token entity" title="\t">\t</span>pam_faillock.so'</span> /etc/pam.d/password-auth
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/iforu/server/firewalld.html">
        firewalld
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/iforu/assets/js/app.24cfdda6.js" defer></script><script src="/iforu/assets/js/2.c8a78117.js" defer></script><script src="/iforu/assets/js/29.8276d66d.js" defer></script>
  </body>
</html>
