(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{361:function(t,s,a){"use strict";a.r(s);var e=a(17),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"initial"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#initial"}},[t._v("#")]),t._v(" Initial")]),t._v(" "),a("p",[t._v("伺服端相關設定")]),t._v(" "),a("h2",{attrs:{id:"hostname"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hostname"}},[t._v("#")]),t._v(" hostname")]),t._v(" "),a("p",[a("code",[t._v("/etc/hostname")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"your_hostname"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /etc/hostname\n")])])]),a("h2",{attrs:{id:"set-sysctl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#set-sysctl"}},[t._v("#")]),t._v(" set sysctl")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("/bin/sh -c "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'cat > set_sysctl.sh << "EOF"\n#! /bin/bash\n\nset -o noclobber\n\nSYSCTLCMD=/sbin/sysctl\nSYSCTLCONF=/etc/sysctl.conf\n\nfunction set_sysctl() {\n    src_value='),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),t._v("$SYSCTLCMD -n $1"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n    if "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("((")]),t._v(" $src_value "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("))")])]),t._v("; then\n        if grep -q ^"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SYSCTLCONF")]),t._v('; then\n            sed -i "/^'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v("/s/[[:digit:]]\\+$/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$2")]),t._v('/" '),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SYSCTLCONF")]),t._v('\n        else\n            echo "'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$2")]),t._v('" >> '),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SYSCTLCONF")]),t._v("\n        fi\n    fi\n}\n\nset_sysctl fs.file-max 1000000\nset_sysctl net.core.somaxconn 3240000\nset_sysctl net.ipv4.tcp_max_syn_backlog 3240000\n\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$SYSCTLCMD")]),t._v(" -p /etc/sysctl.conf\nEOF'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" /bin/sh set_sysctl.sh "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("rm set_sysctl.sh\n")])])]),a("h2",{attrs:{id:"common-packages"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#common-packages"}},[t._v("#")]),t._v(" common packages")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" epel-release\n")])])]),a("h2",{attrs:{id:"chrony"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chrony"}},[t._v("#")]),t._v(" chrony")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" chrony\n")])])]),a("p",[a("code",[t._v("/etc/chrony.conf")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/^pool/a\\server 0.tw.pool.ntp.org iburst"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[t._v("\\n")]),t._v("server 1.tw.pool.ntp.org iburst"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[t._v("\\n")]),t._v("server 2.tw.pool.ntp.org iburst"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[t._v("\\n")]),t._v("server 3.tw.pool.ntp.org iburst'")]),t._v(" /etc/chrony.conf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/^pool/s/^/#/'")]),t._v(" /etc/chrony.conf\nsystemctl start chronyd\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" chronyd\n\nchronyc -a makestep\n")])])]),a("h2",{attrs:{id:"s3cmd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#s3cmd"}},[t._v("#")]),t._v(" S3cmd")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum -y install epel-release")]),t._v("\nyum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" s3cmd\n")])])]),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("s3cmd --configure\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("  Access Key: your ak\n  Secret Key: your sk\n  Default Region: US\n  S3 Endpoint: s3.hicloud.net.tw\n  DNS-style bucket+hostname:port template for accessing a bucket: %(bucket)s.s3.hicloud.net.tw\n  Encryption password:\n  Path to GPG program: /usr/bin/gpg\n  Use HTTPS protocol: True\n  HTTP Proxy server name:\n  HTTP Proxy server port: 0\n  \nTest access with supplied credentials? [Y/n] n\n\nSave settings? [y/N] Y\n")])])]),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/^signature_v2/s/False/True/'")]),t._v(" /root/.s3cfg\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/^signurl_use_https/s/False/True/'")]),t._v(" /root/.s3cfg\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/^use_https/s/False/True/'")]),t._v(" /root/.s3cfg\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/^progress_meter/s/True/False/'")]),t._v(" /root/.s3cfg\ns3cmd "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\n")])])]),a("h2",{attrs:{id:"iserver-linux-agent"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iserver-linux-agent"}},[t._v("#")]),t._v(" iServer Linux Agent")]),t._v(" "),a("ul",[a("li",[t._v("Agent Version : iServer_setup_linux_3.6.7_x86_64.tar")]),t._v(" "),a("li",[t._v("Server IP : 202.39.165.13")]),t._v(" "),a("li",[t._v("跳板機 Server IP：10.190.251.33")]),t._v(" "),a("li",[t._v("InventoryID : "),a("RouterLink",{attrs:{to:"/hicloud/#server-list"}},[t._v("#serverlist")])],1)]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("s3cmd get s3://mgmt/iServer_setup_linux_3.6.7_x86_64.tar ./\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -xf iServer_setup_linux_3.6.7_x86_64.tar\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" setup\n./install.sh\n")])])]),a("p",[t._v("check process")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" aux "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" isAgent\n")])])]),a("h3",{attrs:{id:"policy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#policy"}},[t._v("#")]),t._v(" policy")]),t._v(" "),a("h4",{attrs:{id:"帳戶密碼最大使用期限超過90天"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#帳戶密碼最大使用期限超過90天"}},[t._v("#")]),t._v(" 帳戶密碼最大使用期限超過90天")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("chage -M "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v(" root\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/^PASS_MAX_DAYS/s/[[:digit:]]\\+$/90/'")]),t._v(" /etc/login.defs\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" ^PASS_MAX_DAYS /etc/login.defs\n")])])]),a("h4",{attrs:{id:"閒置連線關閉時間超過30分鐘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#閒置連線關閉時間超過30分鐘"}},[t._v("#")]),t._v(" 閒置連線關閉時間超過30分鐘")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s/^#ClientAliveInterval.*/ClientAliveInterval 600/'")]),t._v(" /etc/ssh/sshd_config\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/ClientAliveCountMax/s/^#//'")]),t._v(" /etc/ssh/sshd_config\nsystemctl restart sshd\n")])])]),a("h4",{attrs:{id:"帳戶登入失敗次數超過3次"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#帳戶登入失敗次數超過3次"}},[t._v("#")]),t._v(" 帳戶登入失敗次數超過3次")]),t._v(" "),a("h4",{attrs:{id:"帳戶密碼最小長度小於12字元"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#帳戶密碼最小長度小於12字元"}},[t._v("#")]),t._v(" 帳戶密碼最小長度小於12字元")]),t._v(" "),a("h4",{attrs:{id:"密碼設定歷程小於3代"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#密碼設定歷程小於3代"}},[t._v("#")]),t._v(" 密碼設定歷程小於3代")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /etc/pam.d/system-auth /etc/pam.d/system-auth.def\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/^auth.*pam_env.so$/a"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\a"}},[t._v("\\a")]),t._v("uth"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),t._v("required"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),t._v("pam_faillock.so preauth silent audit deny=3 unlock_time=1800'")]),t._v(" /etc/pam.d/system-auth\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/^account.*pam_unix.so$/i"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\a"}},[t._v("\\a")]),t._v("ccount"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),t._v("required"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),t._v("pam_faillock.so'")]),t._v(" /etc/pam.d/system-auth\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/^password.*requisite/s/pam_pwquality.*/pam_pwquality.so try_first_pass local_users_only retry=3 authtok_type= minlen=12 dcredit=-1 ucredit=-1 lcredit=-1 ocredit=-1 enforce_for_root/'")]),t._v(" /etc/pam.d/system-auth\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0,/^password/s/\\(^password.*\\)/"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\1"}},[t._v("\\1")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[t._v("\\n")]),t._v("password"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),t._v("requisite"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),t._v("pam_pwhistory.so use_authtok remember=3/'")]),t._v(" /etc/pam.d/system-auth\n")])])]),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /etc/pam.d/password-auth /etc/pam.d/password-auth.def\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/^auth.*pam_env.so$/a"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\a"}},[t._v("\\a")]),t._v("uth"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),t._v("required"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),t._v("pam_faillock.so preauth silent audit deny=3 unlock_time=1800'")]),t._v(" /etc/pam.d/password-auth\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sed")]),t._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/^account.*pam_unix.so$/i"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\a"}},[t._v("\\a")]),t._v("ccount"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),t._v("required"),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),a("span",{pre:!0,attrs:{class:"token entity",title:"\\t"}},[t._v("\\t")]),t._v("pam_faillock.so'")]),t._v(" /etc/pam.d/password-auth\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);